<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Productos - NeoGaming</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéÆ</text></svg>">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-container">
            <a href="home.html" class="navbar-brand">NeoGaming</a>
            <ul class="navbar-menu">
                <li class="navbar-item"><a href="home.html">Inicio</a></li>
                <li class="navbar-item"><a href="search.html">B√∫squeda</a></li>
                <li class="navbar-item"><a href="products.html" class="active">Productos</a></li>
                <li class="navbar-item"><a href="about.html">Acerca de</a></li>
                <li class="navbar-item"><a href="login.html" id="logoutBtn">Salir</a></li>
            </ul>
        </div>
    </nav>

    <!-- Contenido principal -->
    <main class="main-content">
        <div class="container">
            <!-- Hero Section -->
            <section class="hero fade-in">
                <h1 class="hero-title">üéÆ Cat√°logo de Productos</h1>
                <p class="hero-subtitle">Descubre los mejores videojuegos y accesorios</p>
                
                <div class="landing-buttons">
                    <button onclick="showAllProducts()" class="btn btn-primary" id="showAllBtn">
                        üéØ Ver Todos
                    </button>
                    <button onclick="showFeatured()" class="btn btn-secondary">
                        ‚≠ê Destacados
                    </button>
                </div>
            </section>

            <!-- Filtros -->
            <section class="slide-in-left">
                <div style="background: var(--background-card); border-radius: 15px; padding: 20px; margin-bottom: 30px;">
                    <h3 style="color: var(--text-light); margin-bottom: 20px;">üîç Filtrar por categor√≠a</h3>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px;" id="categoryFilters">
                        <button onclick="filterByCategory('all')" class="btn btn-secondary filter-btn active" data-category="all">
                            Todos
                        </button>
                        <button onclick="filterByCategory('Shooter / FPS')" class="btn btn-secondary filter-btn" data-category="Shooter / FPS">
                            üî´ FPS
                        </button>
                        <button onclick="filterByCategory('RPG / Fantas√≠a')" class="btn btn-secondary filter-btn" data-category="RPG / Fantas√≠a">
                            ‚öîÔ∏è RPG
                        </button>
                        <button onclick="filterByCategory('Deportes / Carreras')" class="btn btn-secondary filter-btn" data-category="Deportes / Carreras">
                            üèé Deportes
                        </button>
                        <button onclick="filterByCategory('Estrategia / Simulaci√≥n')" class="btn btn-secondary filter-btn" data-category="Estrategia / Simulaci√≥n">
                            üèóÔ∏è Estrategia
                        </button>
                        <button onclick="filterByCategory('Terror / Suspenso')" class="btn btn-secondary filter-btn" data-category="Terror / Suspenso">
                            üëª Terror
                        </button>
                    </div>
                </div>
            </section>

            <!-- Secci√≥n de productos -->
            <section class="products-section slide-in-right">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 class="section-title">Productos Disponibles</h2>
                    <div style="color: var(--text-gray);">
                        <span id="productCount">0</span> productos encontrados
                    </div>
                </div>
                
                <!-- Loading state -->
                <div id="loadingProducts" style="text-align: center; padding: 40px; display: block;">
                    <div class="loading" style="margin: 0 auto 20px;"></div>
                    <p style="color: var(--text-gray);">Cargando productos...</p>
                </div>
                
                <!-- No products state -->
                <div id="noProducts" style="text-align: center; padding: 40px; display: none;">
                    <div style="font-size: 4rem; margin-bottom: 20px;">üòï</div>
                    <h3 style="color: var(--text-light); margin-bottom: 10px;">No hay productos</h3>
                    <p style="color: var(--text-gray);">No se encontraron productos para esta categor√≠a</p>
                    <button onclick="filterByCategory('all')" class="btn btn-primary" style="margin-top: 20px;">
                        Ver todos los productos
                    </button>
                </div>
                
                <div class="products-grid" id="productsGrid">
                    <!-- Los productos se cargar√°n din√°micamente -->
                </div>
            </section>

            <!-- Secci√≥n de ofertas especiales -->
            <section class="slide-in-left" style="margin-top: 60px;">
                <div style="background: linear-gradient(135deg, var(--accent-purple), var(--accent-orange)); border-radius: 20px; padding: 40px; text-align: center; position: relative; overflow: hidden;">
                    <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.3);"></div>
                    <div style="position: relative; z-index: 10;">
                        <h2 style="color: white; font-size: 2.5rem; margin-bottom: 15px;">üî• Ofertas Especiales</h2>
                        <p style="color: white; font-size: 1.2rem; margin-bottom: 25px;">
                            Descuentos de hasta 50% en t√≠tulos seleccionados
                        </p>
                        <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">
                            <div style="background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border-radius: 10px; padding: 15px; color: white; min-width: 150px;">
                                <div style="font-size: 1.5rem; font-weight: bold;">-30%</div>
                                <div>Juegos AAA</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border-radius: 10px; padding: 15px; color: white; min-width: 150px;">
                                <div style="font-size: 1.5rem; font-weight: bold;">-50%</div>
                                <div>Indies</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); padding: 15px; color: white; min-width: 150px;">
                                <div style="font-size: 1.5rem; font-weight: bold;">-25%</div>
                                <div>DLCs</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Modal para detalles del producto -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <button class="modal-close">&times;</button>
            <div id="modalContent">
                <!-- El contenido se llenar√° din√°micamente -->
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://www.paypal.com/sdk/js?client-id=AZn9TTNsJ_t-mwZYyePx8mwMELbqSZ1OPcaYOsWhaAJ6yHWewrwe2AdDSAgC74wCMmRtWZrD8Rb1br1X&currency=USD"></script>
    <script src="js/auth.js"></script>
    <script src="js/main.js"></script>
    <script src="js/paypal.js"></script>
    
    <script>
        // Variables espec√≠ficas de la p√°gina de productos
        let allProducts = [];
        let currentFilter = 'all';

        // Inicializar p√°gina de productos
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Inicializando p√°gina de productos...');
            
            // No verificar auth para simplificar testing
            // if (!requireAuth()) return;
            
            await loadAllProducts();
            setupProductsEventListeners();
        });

        // Cargar todos los productos
        async function loadAllProducts() {
            console.log('Cargando productos...');
            showLoadingState(true);
            
            try {
                // Primero intentar API
                const API_BASE_URL = getAPIBaseURL ? getAPIBaseURL() : 'http://localhost:3000/api';
                console.log('Intentando cargar desde API:', `${API_BASE_URL}/products`);
                
                const response = await fetch(`${API_BASE_URL}/products`);
                if (response.ok) {
                    allProducts = await response.json();
                    console.log('Productos cargados desde API:', allProducts.length);
                } else {
                    throw new Error(`API Error: ${response.status}`);
                }
            } catch (error) {
                console.warn('Error cargando desde API:', error.message);
                console.log('Usando productos de ejemplo...');
                allProducts = getExtendedExampleProducts();
            }
            
            // Mostrar todos los productos inicialmente
            filterByCategory('all');
            showLoadingState(false);
            
            console.log(`Productos listos: ${allProducts.length} productos cargados`);
        }

        // Mostrar estado de carga
        function showLoadingState(isLoading) {
            const loadingEl = document.getElementById('loadingProducts');
            const gridEl = document.getElementById('productsGrid');
            const noProductsEl = document.getElementById('noProducts');
            
            if (isLoading) {
                loadingEl.style.display = 'block';
                gridEl.style.display = 'none';
                noProductsEl.style.display = 'none';
            } else {
                loadingEl.style.display = 'none';
                gridEl.style.display = 'grid';
            }
        }

        // Mostrar todos los productos
        function displayAllProducts(products) {
            console.log(`Mostrando ${products.length} productos`);
            const productsGrid = document.getElementById('productsGrid');
            const productCount = document.getElementById('productCount');
            const noProductsEl = document.getElementById('noProducts');
            
            if (products.length === 0) {
                productsGrid.style.display = 'none';
                noProductsEl.style.display = 'block';
                productCount.textContent = '0';
                return;
            }
            
            productsGrid.style.display = 'grid';
            noProductsEl.style.display = 'none';
            productsGrid.innerHTML = '';
            productCount.textContent = products.length;
            
            products.forEach((product, index) => {
                const productCard = createProductCard(product);
                productCard.style.animationDelay = `${index * 0.1}s`;
                productsGrid.appendChild(productCard);
            });
        }

        // Crear tarjeta de producto
        function createProductCard(product) {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.setAttribute('data-product-id', product.id);
            
            const price = parseFloat(product.price) || 0;
            
            card.innerHTML = `
                <div class="product-image">
                    ${product.image_url ? 
                        `<img src="${product.image_url}" alt="${product.name}" 
                             loading="lazy"
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                         <div style="display: none; align-items: center; justify-content: center; width: 100%; height: 100%; font-size: 4rem; background: var(--background-gray);">üéÆ</div>` 
                        : 
                        '<div style="display: flex; align-items: center; justify-content: center; width: 100%; height: 100%; font-size: 4rem; background: var(--background-gray);">üéÆ</div>'
                    }
                </div>
                <div class="product-info">
                    <h3 class="product-title">${product.name}</h3>
                    <p class="product-category">${product.category}</p>
                    <p class="product-description">${product.description ? product.description.substring(0, 80) + '...' : 'Descripci√≥n no disponible'}</p>
                    <div class="product-price">$${price.toFixed(2)} USD</div>
                </div>
            `;
            
            card.addEventListener('click', () => showProductModal(product));
            
            return card;
        }

        // Mostrar modal del producto
        function showProductModal(product) {
            const modal = document.getElementById('productModal');
            const modalContent = document.getElementById('modalContent');
            
            if (!modal || !modalContent) {
                console.error('Modal elements not found');
                return;
            }
            
            const price = parseFloat(product.price) || 0;
            
            modalContent.innerHTML = `
                <div class="modal-image">
                    ${product.image_url ? 
                        `<img src="${product.image_url}" alt="${product.name}" 
                             style="width: 100%; height: 100%; object-fit: cover; border-radius: 10px;" 
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                         <div style="display: none; align-items: center; justify-content: center; width: 100%; height: 100%; font-size: 4rem; background: var(--background-gray);">üéÆ</div>` 
                        : 
                        '<div style="display: flex; align-items: center; justify-content: center; width: 100%; height: 100%; font-size: 4rem; background: var(--background-gray);">üéÆ</div>'
                    }
                </div>
                <h2 class="modal-title">${product.name}</h2>
                <p class="modal-category">${product.category}</p>
                <p class="modal-description">${product.description || 'Descripci√≥n no disponible'}</p>
                <div class="modal-price">$${price.toFixed(2)} USD</div>
                <div class="modal-actions">
                    <div id="paypal-button-container-${product.id}" class="paypal-button-container"></div>
                </div>
            `;
            
            modal.classList.add('show');
            
            // Inicializar bot√≥n de PayPal con delay
            setTimeout(() => {
                if (window.initPayPalButton) {
                    console.log('Inicializando PayPal para:', product.name);
                    window.initPayPalButton(product);
                } else {
                    console.warn('initPayPalButton no disponible');
                }
            }, 200);
        }

        // Cerrar modal
        function closeModal() {
            const modal = document.getElementById('productModal');
            if (modal) {
                modal.classList.remove('show');
            }
        }

        // Filtrar por categor√≠a
        function filterByCategory(category) {
            console.log('Filtrando por categor√≠a:', category);
            currentFilter = category;
            
            // Actualizar botones de filtro
            const filterButtons = document.querySelectorAll('.filter-btn');
            filterButtons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-category') === category) {
                    btn.classList.add('active');
                }
            });
            
            // Filtrar productos
            let filteredProducts = allProducts;
            if (category !== 'all') {
                filteredProducts = allProducts.filter(product => product.category === category);
            }
            
            displayAllProducts(filteredProducts);
        }

        // Mostrar todos los productos
        function showAllProducts() {
            filterByCategory('all');
        }

        // Mostrar productos destacados
        function showFeatured() {
            const featuredProducts = allProducts.filter(product => product.price >= 50);
            displayAllProducts(featuredProducts);
            
            // Actualizar contador
            document.getElementById('productCount').textContent = featuredProducts.length;
            
            // Actualizar filtros
            const filterButtons = document.querySelectorAll('.filter-btn');
            filterButtons.forEach(btn => btn.classList.remove('active'));
        }

        // Configurar event listeners espec√≠ficos de productos
        function setupProductsEventListeners() {
            // Cerrar modal al hacer clic en X o fuera del modal
            const modal = document.getElementById('productModal');
            if (modal) {
                const closeBtn = modal.querySelector('.modal-close');
                if (closeBtn) {
                    closeBtn.addEventListener('click', closeModal);
                }
                
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        closeModal();
                    }
                });
            }

            // Event listener para redimensionar la grilla
            window.addEventListener('resize', () => {
                const grid = document.getElementById('productsGrid');
                if (grid) {
                    grid.style.opacity = '0.8';
                    setTimeout(() => {
                        grid.style.opacity = '1';
                    }, 100);
                }
            });
        }

        // Productos de ejemplo extendidos
        function getExtendedExampleProducts() {
            return [
                {
                    id: 1,
                    name: 'Call of Duty: Modern Warfare',
                    description: 'Shooter t√°ctico de √∫ltima generaci√≥n con gr√°ficos realistas y combates intensos que te sumergir√°n en la acci√≥n.',
                    price: 59.99,
                    category: 'Shooter / FPS',
                    image_url: 'https://image.api.playstation.com/vulcan/ap/rnd/202310/0410/c90521de8a000b1b68e0b20237ba88fe8e49cfc3a3ac2f58.png'
                },
                {
                    id: 2,
                    name: 'Final Fantasy XVI',
                    description: '√âpica aventura de fantas√≠a con combates din√°micos, una historia envolvente y personajes inolvidables.',
                    price: 69.99,
                    category: 'RPG / Fantas√≠a',
                    image_url: 'https://assets.nintendo.com/image/upload/c_fill,w_1200/q_auto:best/f_auto/dpr_2.0/ncom/software/switch/70010000063714/58fa8e90b0ee4b894b2e21ac97b59a84f1e1d3d8a8c59ea2acf5b9b89a3cac5a'
                },
                {
                    id: 3,
                    name: 'FIFA 24',
                    description: 'La experiencia futbol√≠stica m√°s realista del a√±o con nuevas mec√°nicas de juego y modo carrera mejorado.',
                    price: 49.99,
                    category: 'Deportes / Carreras',
                    image_url: 'https://image.api.playstation.com/vulcan/ap/rnd/202305/1210/1684a4434e5ceb5c10db17bc7ac32862a59b0e4dcdd46b3a.jpg'
                },
                {
                    id: 4,
                    name: 'Minecraft Legends',
                    description: 'Construye, explora y sobrevive en mundos infinitos llenos de posibilidades y aventuras √©picas.',
                    price: 39.99,
                    category: 'Estrategia / Simulaci√≥n',
                    image_url: 'https://image.api.playstation.com/vulcan/ap/rnd/202306/1219/48c673a6b90e3e5bd6e1fcc0606dcba40ad43b3b69f5a2f6.png'
                },
                {
                    id: 5,
                    name: 'Resident Evil 4 Remake',
                    description: 'Horror de supervivencia que te mantendr√° al borde del asiento con gr√°ficos renovados y jugabilidad mejorada.',
                    price: 59.99,
                    category: 'Terror / Suspenso',
                    image_url: 'https://image.api.playstation.com/vulcan/ap/rnd/202305/1719/caedc8ceb709d0b2e2b71549be9b6cff2e95bbff59e92f3e.png'
                },
                {
                    id: 6,
                    name: 'Counter-Strike 2',
                    description: 'El FPS competitivo definitivo con nuevos gr√°ficos, mec√°nicas mejoradas y modo competitivo renovado.',
                    price: 29.99,
                    category: 'Shooter / FPS',
                    image_url: 'https://shared.akamai.steamstatic.com/store_item_assets/steam/apps/730/header.jpg'
                },
                {
                    id: 7,
                    name: 'The Elder Scrolls VI',
                    description: 'La pr√≥xima gran aventura en el mundo de Elder Scrolls con un mundo abierto masivo por explorar.',
                    price: 79.99,
                    category: 'RPG / Fantas√≠a',
                    image_url: 'https://image.api.playstation.com/vulcan/ap/rnd/202302/2321/ba706e54d68d10a0334529312681f8991d1dd9bf6fd46231.png'
                },
                {
                    id: 8,
                    name: 'Gran Turismo 7',
                    description: 'Simulador de carreras premium con los autos m√°s exclusivos del mundo y pistas legendarias.',
                    price: 54.99,
                    category: 'Deportes / Carreras',
                    image_url: 'https://compass-ssl.xbox.com/assets/d2/90/d2909e95-6f74-46c2-baa6-6d34a4d9a8a8.jpg'
                },
                {
                    id: 9,
                    name: 'Cities: Skylines II',
                    description: 'Constructor de ciudades definitivo con mec√°nicas avanzadas y posibilidades infinitas de dise√±o.',
                    price: 44.99,
                    category: 'Estrategia / Simulaci√≥n',
                    image_url: 'https://image.api.playstation.com/vulcan/ap/rnd/202306/1219/48c673a6b90e3e5bd6e1fcc0606dcba40ad43b3b69f5a2f6.png'
                },
                {
                    id: 10,
                    name: 'Silent Hill 2 Remake',
                    description: 'El cl√°sico del terror psicol√≥gico regresa completamente renovado con gr√°ficos de nueva generaci√≥n.',
                    price: 64.99,
                    category: 'Terror / Suspenso',
                    image_url: 'https://image.api.playstation.com/vulcan/ap/rnd/202212/1315/2nXUeKVLNFMqYTfRQrCfHRMh.png'
                }
            ];
        }

        // Hacer funciones disponibles globalmente
        window.filterByCategory = filterByCategory;
        window.showAllProducts = showAllProducts;
        window.showFeatured = showFeatured;
        window.closeModal = closeModal;
        window.showProductModal = showProductModal;
    </script>
</body>
</html>
